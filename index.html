<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>My first three.js app</title>
    <link type="text/css" rel="stylesheet" href="./styles/main.css">


</head>
<body>

<script id="fragmentShaderPosition" type="x-shader/x-fragment">
    uniform float time;
    uniform float delta;

    void main(){
        vec2 uv = gl_FragCoord.xy / resolution.xy;
        vec4 tmpPos = texture2D(texturePosition, uv);
        vec3 position = tmpPos.xyz;
        vec3 velocity = texture2D(textureVelocity, uv).xyz;

        float phase = tmpPos.w;

        phase = mod( ( phase + delta +
                length( velocity.xz ) * delta * 3. +
                max( velocity.y, 0.0 ) * delta * 6. ), 62.83 );

        gl_FragColor = vec4( position + velocity * delta * 15. , phase);
    }
</script>

<script id="fragmentShaderVelocity" type="x-shader/x-fragment">
    uniform float time;
    uniform float testing;
    uniform float delta;
    uniform float separationDistance;
    uniform float alignmentDistance;
    uniform float cohesionDistance;
    uniform float freedomFactor;
    uniform vec3 predator

    const float width = resolution.x;
    const float height = resolution.y;

    const float PI = 3.141592653589793;
    const float PI_2 = PI * 2.0;

    float zoneRadius = 40.0;
    float zoneRadiusSquared = 1600.0;

    float separationThresh = 0.45;
    float alignmentThresh = 0.65;

    const float UPPER_BOUNDS = BOUNDS;
    const float LOWER_BOUNDS = UPPER_BOUNDS;

    const float SPEED_LIMIT = 9.0

    float rand(vec2 co){
        return fract( sin( dot( co.xy, vec2(12.9898, 78.233) ) ) * 43758.5453);
    }

    void main(){
        zoneRadius = separationDistance + alignmentDistance + cohesionDistance;
        separationThresh = separationDistance / zoneRadius;
        alignmentThresh = ( separationDistance + alignmentDistance ) / zoneRadius;
        zoneRadiusSquared = zoneRadius + zoneRadius;

        vec2 uv = gl_FragCoord.xy / resolution.xy;
        vec3 birdPosition, birdVelocity;

        vec3 selfPosition = texture2D( texturePosition, uv).xyz;
        vec3 selfVelocity = texture2D( textureVelocity, uv).xyz;

        float dist;
        vec3 dir;
        float distSquared;

        float separationSquared = separationDistance * separationDistance;
        float cohesionSquared = cohesionDistance * cohesionDistance;

        float f;
        float percent;

        vec3 velocity = selfVelocity;

        float limit = SPEED_LIMIT;

        dir = predator * UPPER_BOUNDS - selfPosition;
        dir.z = 0.;

        dist = length( dir );
        distSquared = dist * dist;

        float preyRadius = 150.0;
        float preyRadiusSq = preyRadius * preyRadius;

        if(dist < preyRadius){
            f = ( distSquared / preyRadius - 1.0) * delta * 100.;
            velocity += normalize( dir ) * f;
            limit += 5.0;
        }

        vec3 central = vec3(0., 0., 0.);
        dir = selfPosition - central;
        dist = length( dir );

        dir.y *= 2.5;
        velocity -= normalize( dir ) * delta * 5.;

        for( float y = 0.0; y < height; y++){
            for( float x = 0.0; x < width; x++ ){

            }
        }
    }
</script>

<script src="dist/index.js"></script>
</body>
</html>